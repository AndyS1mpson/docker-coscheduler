# Docker coscheduler
Реализация стратегий кошедулинга вычислительных задач, используя подход blackbox для задач, который реализован с помощью Docker

# Описание системы
Планировщик состоит из 2 основных компонент:
* Воркер - программная реализация процессов, которые запускаются на нодах и отвечают за выполнение задач
* Сам планировщик - запускается на main-узле и реализует стратегии кошедулинга

# Необходимые инструменты для запуска системы
* На всех нодах системы должен быть установлен и запущен Docker Daemon;
* На нодах должна быть установлена консольная утилита perf

# Запуск проекта
1. Для запуска проекта необходимо в корне репозитория создать `scheduler.yaml` и `worker.yaml` файлы, пример можно взять из `worker.example.yaml` или `scheduler.example.yaml`.
2. В папке deployments необходимо создать `.env` файл (пример можно взять из `env.example`).
3. Далее необходимо сгенерировать необходимые proto модули в проекте:
> make generate
4. Необходимо поднять базу данных командой:
> make run-database
5. В терминале импортировать соответствующую переменную окружения:
> export POSTGRES_URL="postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable"  # пример connection string для базы данных  
6. Выполнить миграции:
> make migrate
7. После этого можно запустить проект:
* Воркер:
> make run-worker
* Планировщик:
> make run-main

# Создание миграция
1. Чтобы выполнить миграцию баз данных, необходимо установить библиотеку goose:
> go install github.com/pressly/goose/v3/cmd/goose@latest

2. Перейти в папку migration соответствующего микросервиса и выполнить команду:
> goose create \*имя миграции\* sql

3. В терминале импортировать соответствующую переменную окружения:
> POSTGRES_URL  # connection string для базы данных  
4. выполнить комманду:
> make migrate
